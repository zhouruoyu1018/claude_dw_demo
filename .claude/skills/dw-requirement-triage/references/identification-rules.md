# 数仓需求识别规则详解

## 关键词特征库

### 数仓开发关键词 (保留)

**统计类**
- 统计、汇总、合计、总计、累计
- 平均、均值、中位数
- 最大、最小、峰值
- 占比、比例、分布

**分析类**
- 分析、趋势、走势
- 同比、环比、增长率、增幅
- 对比、比较、排名、Top N
- 下钻、上卷、切片

**报表类**
- 报表、报告、Dashboard、大屏
- 图表、折线图、柱状图、饼图
- 导出、Excel、CSV

**时间相关**
- 每日、每周、每月、每年
- T+1、历史、快照
- 过去N天、近N月
- 周期性、定时

**数据层面**
- 指标、度量、KPI
- 维度、粒度
- 明细、汇总、聚合

### 应用开发关键词 (排除)

**交互类**
- 点击、双击、长按、滑动
- 跳转、返回、刷新
- 弹窗、浮层、提示、Toast
- 展开、收起、折叠

**表单类**
- 输入、填写、选择
- 提交、保存、取消
- 校验、验证、必填
- 上传、下载（文件）

**UI类**
- 颜色、字体、大小
- 布局、样式、动画
- 响应式、自适应

**实时事务类**
- 新增、修改、删除（单条）
- 审批、审核（流程）
- 通知、推送、消息

## 复合判断规则

### 规则1: 时间维度判断
```
IF 涉及"历史数据" OR "周期性统计" OR "T+1"
THEN 数仓需求
ELSE IF 仅涉及"当前状态" OR "实时单条"
THEN 应用需求
```

### 规则2: 数据量判断
```
IF 涉及"大量数据导出" OR "全量统计" OR "跨月/年数据"
THEN 数仓需求
ELSE IF 仅涉及"单条记录" OR "分页列表"
THEN 应用需求
```

### 规则3: 计算复杂度判断
```
IF 涉及"同比环比" OR "复杂聚合" OR "多表关联统计"
THEN 数仓需求
ELSE IF 仅涉及"简单查询" OR "单表操作"
THEN 应用需求（可能）
```

### 规则4: 输出形式判断
```
IF 输出为"报表" OR "图表" OR "Excel批量导出"
THEN 数仓需求
ELSE IF 输出为"页面展示" OR "API响应" OR "表单"
THEN 应用需求（需进一步判断）
```

## 灰色地带处理

以下场景需要特别注意，可能需要与业务方确认：

### 1. 列表页统计
**场景**: "订单列表页显示总金额"
- 如果是当前筛选条件下的求和 → 后端实时计算
- 如果是全量历史统计 → 数仓计算

### 2. 用户画像
**场景**: "用户详情页展示累计消费"
- 如果需要实时准确 → 后端计算
- 如果允许 T+1 延迟 → 数仓计算更高效

### 3. 排行榜
**场景**: "商品销量排行"
- 实时排行 → 后端 + 缓存
- 日/周/月排行 → 数仓计算

### 4. 搜索统计
**场景**: "搜索热词统计"
- 实时热词 → Doris 实时聚合
- 历史趋势 → Hive 批量计算

## 埋点需求识别

### 前端埋点 (数仓需接收)
- 页面浏览 (PV/UV)
- 按钮点击
- 停留时长
- 滚动深度
- 曝光事件

### 业务埋点 (可能已在业务库)
- 订单创建
- 支付完成
- 用户注册

### 系统埋点 (运维相关)
- 错误日志
- 性能指标
- 接口耗时

## 需求分类决策树

```
需求文档
│
├─ 是否有明确的"报表/统计/分析"章节?
│  ├─ 是 → 直接提取该章节 (数仓需求)
│  └─ 否 → 继续逐段分析
│
├─ 段落是否包含数仓关键词?
│  ├─ 是 → 初步标记为数仓需求
│  │      └─ 检查是否有排除关键词混合
│  │         ├─ 有 → 拆分需求或标记待确认
│  │         └─ 无 → 确认为数仓需求
│  └─ 否 → 继续判断
│
├─ 是否涉及历史数据或周期性?
│  ├─ 是 → 可能是数仓需求，标记待确认
│  └─ 否 → 继续判断
│
├─ 是否涉及大量数据处理?
│  ├─ 是 → 可能是数仓需求，标记待确认
│  └─ 否 → 排除 (应用需求)
│
└─ 其他 → 排除 (应用需求)
```
