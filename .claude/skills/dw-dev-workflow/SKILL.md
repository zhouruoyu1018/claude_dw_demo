---
name: dw-dev-workflow
description: æ•°ä»“å¼€å‘å…¨æµç¨‹å·¥ä½œæµã€‚ä¸²è” dw-requirement-triage â†’ search-hive-metadata â†’ generate-standard-ddl â†’ generate-etl-sql â†’ generate-qa-suite äº”ä¸ª skillï¼Œå®ç°ä»éœ€æ±‚åˆ°ä¸Šçº¿çš„ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–ã€‚ä½¿ç”¨åœºæ™¯ï¼š(1) æ”¶åˆ°ä¸šåŠ¡éœ€æ±‚æ–‡æ¡£åå¯åŠ¨å®Œæ•´å¼€å‘æµç¨‹ (2) éœ€è¦ä¸€ç«™å¼ç”Ÿæˆ DDLã€ETLã€æµ‹è¯•è„šæœ¬
---

# æ•°ä»“å¼€å‘å·¥ä½œæµ (DW Dev Workflow)

ä¸€ç«™å¼ä¸²è”æ•°ä»“å¼€å‘å…¨æµç¨‹ï¼Œä»éœ€æ±‚æ‹†è§£åˆ°æµ‹è¯•å¥—ä»¶ç”Ÿæˆï¼Œå®ç°ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–ã€‚

## æµç¨‹æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ•°ä»“å¼€å‘å·¥ä½œæµ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   éœ€æ±‚æ–‡æ¡£                                                                   â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚   â”‚ Phase 1: éœ€æ±‚æ‹†è§£      â”‚  â† dw-requirement-triage                       â”‚
â”‚   â”‚ â€¢ è¯†åˆ«æ•°ä»“éœ€æ±‚         â”‚                                                 â”‚
â”‚   â”‚ â€¢ æå–æŒ‡æ ‡/ç»´åº¦        â”‚                                                 â”‚
â”‚   â”‚ â€¢ ç¡®å®šåˆ†å±‚/å¼•æ“        â”‚                                                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚               â”‚                                                             â”‚
â”‚               â–¼                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚   â”‚ Phase 2: å¤ç”¨æ£€ç´¢      â”‚  â† search-hive-metadata                        â”‚
â”‚   â”‚ â€¢ æŒ‡æ ‡åº“æŸ¥è¯¢           â”‚    (MCP Server)                                â”‚
â”‚   â”‚ â€¢ ç°æœ‰è¡¨æœç´¢           â”‚                                                 â”‚
â”‚   â”‚ â€¢ ç²’åº¦åŒ¹é…åˆ¤æ–­         â”‚                                                 â”‚
â”‚   â”‚ â€¢ è¯æ ¹æŸ¥è¯¢             â”‚                                                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚               â”‚                                                             â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚       â–¼               â–¼                                                     â”‚
â”‚   [å¤ç”¨ç°æœ‰]      [éœ€è¦å¼€å‘]                                                 â”‚
â”‚       â”‚               â”‚                                                     â”‚
â”‚   ç›´æ¥ SELECT    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                â”‚
â”‚                  â–¼         â”‚                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                                â”‚
â”‚   â”‚ Phase 3: æ¨¡å‹è®¾è®¡      â”‚â”‚ â† generate-standard-ddl                       â”‚
â”‚   â”‚ â€¢ å»ºæ¨¡å†³ç­–(æ–°å»º/æ‰©åˆ—)  â”‚â”‚                                                â”‚
â”‚   â”‚ â€¢ å­—æ®µå‘½åæ ‡å‡†åŒ–       â”‚â”‚                                                â”‚
â”‚   â”‚ â€¢ ç”Ÿæˆ DDL            â”‚â”‚                                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                                â”‚
â”‚               â”‚            â”‚                                                â”‚
â”‚               â–¼            â”‚                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                                â”‚
â”‚   â”‚ Phase 4: ETL å¼€å‘      â”‚â”‚ â† generate-etl-sql                            â”‚
â”‚   â”‚ â€¢ æºè¡¨åˆ†æ             â”‚â”‚                                                â”‚
â”‚   â”‚ â€¢ æ˜ å°„é€»è¾‘æ„å»º         â”‚â”‚                                                â”‚
â”‚   â”‚ â€¢ ç”Ÿæˆ INSERT SQL      â”‚â”‚                                                â”‚
â”‚   â”‚ â€¢ æŒ‡æ ‡å…¥åº“             â”‚â”‚                                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                                â”‚
â”‚               â”‚            â”‚                                                â”‚
â”‚               â–¼            â”‚                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                                â”‚
â”‚   â”‚ Phase 4.5: SQL å®¡æŸ¥    â”‚â”‚ â† review-sql (å¯é€‰)                           â”‚
â”‚   â”‚ â€¢ ä»£ç è§„èŒƒæ£€æŸ¥         â”‚â”‚   --review å‚æ•°è§¦å‘                            â”‚
â”‚   â”‚ â€¢ è¾“å‡ºå®¡æŸ¥æŠ¥å‘Š         â”‚â”‚                                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                                â”‚
â”‚               â”‚            â”‚                                                â”‚
â”‚               â–¼            â”‚                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                                â”‚
â”‚   â”‚ Phase 5: æµ‹è¯•å¥—ä»¶      â”‚â”‚ â† generate-qa-suite                           â”‚
â”‚   â”‚ â€¢ å†’çƒŸæµ‹è¯• SQL         â”‚â”‚                                                â”‚
â”‚   â”‚ â€¢ DQC è§„åˆ™             â”‚â”‚                                                â”‚
â”‚   â”‚ â€¢ Doris æ€§èƒ½åˆ†æ       â”‚â”‚                                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                                â”‚
â”‚               â”‚            â”‚                                                â”‚
â”‚               â–¼            â”‚                                                â”‚
â”‚         [äº¤ä»˜ç‰©æ±‡æ€»]â—„â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä½¿ç”¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šå®Œæ•´æµç¨‹

ç”¨æˆ·æä¾›éœ€æ±‚æ–‡æ¡£æˆ–æè¿°åï¼Œç³»ç»Ÿè‡ªåŠ¨ä¸²è”æ‰§è¡Œå…¨éƒ¨ 5 ä¸ªé˜¶æ®µï¼š

```
ç”¨æˆ·: å¸®æˆ‘å¼€å‘ä¸€ä¸ªæŒ‰æ—¥+äº§å“ç»Ÿè®¡æ”¾æ¬¾é‡‘é¢çš„æŠ¥è¡¨

åŠ©æ‰‹:
1. [Phase 1] éœ€æ±‚æ‹†è§£ â†’ è¯†åˆ«ä¸ºèšåˆç»Ÿè®¡éœ€æ±‚ï¼ŒæŒ‡æ ‡=æ”¾æ¬¾é‡‘é¢ï¼Œç»´åº¦=æ—¥æœŸ+äº§å“
2. [Phase 2] å¤ç”¨æ£€ç´¢ â†’ æœç´¢æŒ‡æ ‡åº“ï¼Œæ£€æŸ¥æ˜¯å¦å·²æœ‰æ”¾æ¬¾é‡‘é¢æŒ‡æ ‡...
3. [Phase 3] æ¨¡å‹è®¾è®¡ â†’ ç”Ÿæˆ DDL...
4. [Phase 4] ETL å¼€å‘ â†’ ç”Ÿæˆ INSERT SQL...
5. [Phase 5] æµ‹è¯•å¥—ä»¶ â†’ ç”Ÿæˆå†’çƒŸæµ‹è¯•å’Œ DQC è§„åˆ™...
```

### æ–¹å¼äºŒï¼šé˜¶æ®µæ‰§è¡Œ

ç”¨æˆ·å¯æŒ‡å®šä»æŸä¸ªé˜¶æ®µå¼€å§‹ï¼Œæˆ–åªæ‰§è¡Œç‰¹å®šé˜¶æ®µï¼š

```
ç”¨æˆ·: æˆ‘å·²ç»æœ‰ DDL äº†ï¼Œå¸®æˆ‘ç”Ÿæˆ ETL å’Œæµ‹è¯•è„šæœ¬
åŠ©æ‰‹: [ä» Phase 4 å¼€å§‹ï¼Œè·³è¿‡ Phase 1-3]
```

**å‰ç½®æ•°æ®æ ¡éªŒ**: ä¸­é€”è¿›å…¥æ—¶ï¼Œå¿…é¡»å…ˆæ£€æŸ¥è·³è¿‡é˜¶æ®µçš„äº§å‡ºç‰©æ˜¯å¦å·²å°±ç»ªï¼Œç¼ºå¤±åˆ™æç¤ºç”¨æˆ·è¡¥å……ï¼š

| èµ·å§‹é˜¶æ®µ | å¿…éœ€çš„å‰ç½®æ•°æ® | æ ¡éªŒæ–¹å¼ |
|---------|--------------|---------|
| `--from=ddl` (Phase 3) | éœ€æ±‚å­—æ®µåˆ—è¡¨ã€å»ºè®®åˆ†å±‚/å¼•æ“ | è¯¢é—®ç”¨æˆ·æä¾›éœ€æ±‚æè¿°æˆ–æŒ‡æ ‡åˆ—è¡¨ |
| `--from=etl` (Phase 4) | ç›®æ ‡è¡¨ DDLï¼ˆå«ä¸»é”®ã€å­—æ®µã€COMMENTï¼‰ | æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æä¾›äº† DDL æ–‡ä»¶è·¯å¾„æˆ–å†…å®¹ï¼Œæœªæä¾›åˆ™è¦æ±‚è¡¥å…… |
| `--from=qa` (Phase 5) | ETL SQL + ç›®æ ‡è¡¨ DDL | æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æä¾›äº† ETL å’Œ DDL æ–‡ä»¶è·¯å¾„ï¼Œæœªæä¾›åˆ™è¦æ±‚è¡¥å…… |

æœªé€šè¿‡æ ¡éªŒæ—¶ï¼Œåˆ—å‡ºç¼ºå¤±é¡¹å¹¶è¯¢é—®ç”¨æˆ·æä¾›ï¼Œ**ä¸è‡ªåŠ¨è·³è¿‡**ã€‚

### æ–¹å¼ä¸‰ï¼šäº¤äº’å¼ç¡®è®¤

æ¯ä¸ªé˜¶æ®µå®Œæˆåç­‰å¾…ç”¨æˆ·ç¡®è®¤å†ç»§ç»­ï¼š

```
ç”¨æˆ·: é€æ­¥å¸®æˆ‘å¼€å‘ï¼Œæ¯æ­¥ç¡®è®¤
åŠ©æ‰‹: [Phase 1 å®Œæˆ] è¯·ç¡®è®¤éœ€æ±‚æ‹†è§£ç»“æœæ˜¯å¦æ­£ç¡®ï¼Ÿ
ç”¨æˆ·: ç¡®è®¤
åŠ©æ‰‹: [Phase 2 å®Œæˆ] å‘ç°æŒ‡æ ‡åº“å·²æœ‰ "æ”¾æ¬¾é‡‘é¢"ï¼Œæ˜¯å¦ç›´æ¥å¤ç”¨ï¼Ÿ
ç”¨æˆ·: å¤ç”¨
åŠ©æ‰‹: å·²å¤ç”¨ç°æœ‰æŒ‡æ ‡ï¼Œæ— éœ€ç»§ç»­å¼€å‘ã€‚
```

---

## é˜¶æ®µè¯¦è§£

### Phase 1: éœ€æ±‚æ‹†è§£ (dw-requirement-triage)

**è§¦å‘æ¡ä»¶**: ç”¨æˆ·æä¾›éœ€æ±‚æ–‡æ¡£æˆ–ä¸šåŠ¡æè¿°

**æ‰§è¡Œå†…å®¹**:
1. æ‰«ææ–‡æ¡£ï¼Œè¯†åˆ«æ•°ä»“éœ€æ±‚ vs åº”ç”¨éœ€æ±‚
2. æå–æŒ‡æ ‡ï¼ˆSUM/COUNT/AVG ç­‰èšåˆï¼‰å’Œç»´åº¦ï¼ˆGROUP BY å­—æ®µï¼‰
3. åˆ¤æ–­æ—¶é—´ç²’åº¦ï¼ˆæ—¥/å‘¨/æœˆï¼‰
4. å»ºè®®åˆ†å±‚ï¼ˆdm/daï¼‰å’Œå¼•æ“ï¼ˆHive/Impala/Dorisï¼‰
5. è¯†åˆ«æ•°æ®ç²’åº¦ï¼ˆä» TBLPROPERTIES æˆ–è¡¨æ³¨é‡Š `[ç²’åº¦ï¼š...]` è·å–ï¼‰

**è¾“å‡º**:
```yaml
éœ€æ±‚åç§°: æ”¾æ¬¾äº§å“æ—¥æŠ¥è¡¨
æŒ‡æ ‡:
  - å½“æ—¥æ”¾æ¬¾é‡‘é¢ (SUM)
  - å½“æ—¥æ”¾æ¬¾ç¬”æ•° (COUNT)
ç»´åº¦:
  - äº§å“ç¼–ç 
  - æ•°æ®æ—¥æœŸ
æ—¶é—´ç²’åº¦: æ—¥
å»ºè®®åˆ†å±‚: dm
å»ºè®®å¼•æ“: Hive (T+1)
```

**ç”¨æˆ·ç¡®è®¤ç‚¹**: éœ€æ±‚æ‹†è§£ç»“æœæ˜¯å¦æ­£ç¡®

---

### Phase 2: å¤ç”¨æ£€ç´¢ (search-hive-metadata)

**è§¦å‘æ¡ä»¶**: Phase 1 å®Œæˆ

**æ‰§è¡Œå†…å®¹**:
1. **æŒ‡æ ‡å¤ç”¨æ£€æŸ¥**: è°ƒç”¨ `search_existing_indicators` æŸ¥è¯¢æŒ‡æ ‡åº“
   - æ‰¾åˆ° â†’ å±•ç¤ºå£å¾„ï¼Œè¯¢é—®æ˜¯å¦å¤ç”¨
   - æœªæ‰¾åˆ° â†’ ç»§ç»­ä¸‹ä¸€æ­¥
2. **ç°æœ‰è¡¨æœç´¢**: è°ƒç”¨ `search_table` å’Œ `search_by_comment` æœç´¢åŒä¸»é¢˜è¡¨
3. **å¤šæºæ¶ˆæ­§**ï¼ˆå½“å­—æ®µå‡ºç°åœ¨å¤šå¼ è¡¨æ—¶ï¼‰:
   - åº”ç”¨ç»¼åˆè¯„åˆ†ç­–ç•¥ï¼šå£å¾„(40) > ç²’åº¦(30) > åˆ†å±‚(20) > è¦†ç›–(10)
   - è¾“å‡ºå€™é€‰è¡¨æ’ååŠè¯„åˆ†æ˜ç»†
   - åˆ†å·® â‰¥ 10 è‡ªåŠ¨é€‰æ‹©ï¼Œåˆ†å·® < 10 è¯¢é—®ç”¨æˆ·
4. **ç²’åº¦åŒ¹é…åˆ¤æ–­**:
   - ä¼˜å…ˆä» TBLPROPERTIES è·å–ç²’åº¦
   - è‹¥æ— ï¼Œä»è¡¨æ³¨é‡Š `[ç²’åº¦ï¼šå­—æ®µ1ï¼Œå­—æ®µ2]` è§£æ
   - æ¯”å¯¹æ–°éœ€æ±‚ç»´åº¦ä¸ç°æœ‰è¡¨ç²’åº¦
5. **è¯æ ¹æŸ¥è¯¢**: è°ƒç”¨ `search_word_root` è·å–æ ‡å‡†è¯æ ¹

**å†³ç­–åˆ†æ”¯**:
```
æŒ‡æ ‡å·²å­˜åœ¨ + å£å¾„ä¸€è‡´  â†’  ç›´æ¥å¤ç”¨ï¼Œæµç¨‹ç»“æŸ
æŒ‡æ ‡ä¸å­˜åœ¨ OR å£å¾„ä¸ç¬¦  â†’  ç»§ç»­ Phase 3
ç°æœ‰è¡¨ç²’åº¦åŒ¹é…  â†’  Phase 3 èµ°æ‰©åˆ—è·¯å¾„
ç°æœ‰è¡¨ç²’åº¦ä¸åŒ¹é…  â†’  Phase 3 èµ°æ–°å»ºè·¯å¾„
å¤šæºå€™é€‰åˆ†æ•°æ¥è¿‘  â†’  è¯¢é—®ç”¨æˆ·é€‰æ‹©æ•°æ®æº
```

**ç”¨æˆ·ç¡®è®¤ç‚¹**:
- æ˜¯å¦å¤ç”¨ç°æœ‰æŒ‡æ ‡
- å¤šæºå€™é€‰è¡¨é€‰æ‹©ï¼ˆåˆ†å·® < 10 æ—¶ï¼‰
- æ‰©åˆ—è¿˜æ˜¯æ–°å»ºè¡¨

---

### Phase 3: æ¨¡å‹è®¾è®¡ (generate-standard-ddl)

**è§¦å‘æ¡ä»¶**: Phase 2 å†³å®šéœ€è¦å¼€å‘

**æ‰§è¡Œå†…å®¹**:
1. ç¡®å®šåˆ†å±‚å’Œè¡¨åï¼ˆå‘½åè§„èŒƒï¼š`dmm_sac_{ä¸»é¢˜}_{ç²’åº¦}`ï¼‰
2. å»ºæ¨¡å†³ç­–ï¼š
   - **CASE A (æ‰©åˆ—)**: ç°æœ‰è¡¨ç²’åº¦åŒ¹é… â†’ `ALTER TABLE ADD COLUMN`
   - **CASE B (æ–°å»º)**: æ— åŒ¹é…è¡¨ â†’ `CREATE TABLE`
   - **CASE C (å†²çª)**: ç²’åº¦åŒ¹é…ä½†ä¸šåŠ¡è·¨åº¦å¤§ â†’ è¯¢é—®ç”¨æˆ·
3. å­—æ®µå‘½åï¼šæŸ¥è¯æ ¹è¡¨ï¼Œç»„è£…æ ‡å‡†å­—æ®µå
4. ç”Ÿæˆ DDLï¼ˆå« COMMENTã€TBLPROPERTIESã€é€»è¾‘ä¸»é”®ï¼‰

**è¾“å‡º**: å®Œæ•´çš„ CREATE TABLE æˆ– ALTER TABLE è¯­å¥

**ç”¨æˆ·ç¡®è®¤ç‚¹**: DDL æ˜¯å¦ç¬¦åˆé¢„æœŸ

---

### Phase 4: ETL å¼€å‘ (generate-etl-sql)

**è§¦å‘æ¡ä»¶**: Phase 3 å®Œæˆ

**æ‰§è¡Œå†…å®¹**:
1. è§£ææºè¡¨ Schemaï¼ˆä» Phase 2 è·å–ï¼‰
2. **è¯¢é—®ç”Ÿæˆæ¨¡å¼**: æ˜¯å¦éœ€è¦ç”Ÿæˆå†å²æ•°æ®åˆå§‹åŒ–è„šæœ¬ï¼Ÿ
   - **é»˜è®¤**: ä»…ç”Ÿæˆå¢é‡è„šæœ¬ï¼ˆT+1 æ—¥å¸¸è°ƒåº¦ï¼‰
   - **å¯é€‰**: åŒæ—¶ç”Ÿæˆå¢é‡ + åˆå§‹åŒ–è„šæœ¬ï¼ˆæ–°è¡¨ä¸Šçº¿å›åˆ·ï¼‰
3. åˆ†æåŠ å·¥æ¨¡å¼ï¼ˆç®€å•èšåˆ/å¤šè¡¨å…³è”/çª—å£è®¡ç®—/åˆ†ç»„é›†ï¼‰
4. æ„å»º SQL ç»“æ„ï¼ˆCTE æ‹†è§£å¤æ‚é€»è¾‘ï¼‰
5. ç”Ÿæˆ INSERT OVERWRITE SQLï¼ˆé€‚é…ç›®æ ‡å¼•æ“è¯­æ³•ï¼‰
   - å¢é‡æ¨¡å¼ï¼š`WHERE stat_date = '${stat_date}'`ï¼Œé™æ€åˆ†åŒº
   - åˆå§‹åŒ–æ¨¡å¼ï¼š`WHERE stat_date BETWEEN '${start_date}' AND '${end_date}'`ï¼ŒåŠ¨æ€åˆ†åŒº
6. **æŒ‡æ ‡å…¥åº“æ£€æŸ¥**: è¯†åˆ«æ–°æŒ‡æ ‡ï¼Œè¯¢é—®æ˜¯å¦æ³¨å†Œåˆ°æŒ‡æ ‡åº“
7. **è¡€ç¼˜æ³¨å†Œ**: è‡ªåŠ¨æå–å¹¶æ³¨å†Œè¡¨çº§/å­—æ®µçº§è¡€ç¼˜å…³ç³»

**è¾“å‡º**:
- **å¢é‡æ¨¡å¼**: `{table_name}_etl.sql`
- **åˆå§‹åŒ–æ¨¡å¼**: `{table_name}_etl.sql` + `{table_name}_init.sql`

**ç”¨æˆ·ç¡®è®¤ç‚¹**:
- æ˜¯å¦éœ€è¦ç”Ÿæˆåˆå§‹åŒ–è„šæœ¬ï¼ˆæ–°è¡¨ä¸Šçº¿åœºæ™¯ï¼‰
- ETL é€»è¾‘æ˜¯å¦æ­£ç¡®
- æ–°æŒ‡æ ‡æ˜¯å¦å…¥åº“

**è‡ªåŠ¨æ‰§è¡Œï¼ˆæ— éœ€ç¡®è®¤ï¼‰**:
- è¡€ç¼˜æ³¨å†Œï¼ˆè°ƒç”¨ `register_lineage`ï¼‰

---

### Phase 4.5: SQL å®¡æŸ¥ (review-sql) â€” å¯é€‰

**è§¦å‘æ¡ä»¶**: Phase 4 å®Œæˆ + ç”¨æˆ·ä½¿ç”¨ `--review` å‚æ•°æˆ–æ‰‹åŠ¨è¯·æ±‚å®¡æŸ¥

**æ‰§è¡Œå†…å®¹**:
1. å°† Phase 4 ç”Ÿæˆçš„ ETL SQL ä½œä¸ºè¾“å…¥
2. æ‰§è¡Œ review-sql å®¡æŸ¥æµç¨‹ï¼ˆDDL è§„åˆ™ + ETL è§„åˆ™ + é€šç”¨è§„åˆ™ï¼‰
3. è¾“å‡ºå®¡æŸ¥æŠ¥å‘Šï¼ˆFATAL/ERROR/WARN/INFO åˆ†çº§ï¼‰
4. å¦‚æœ‰ FATAL é¡¹ï¼Œé˜»æ–­æµç¨‹å¹¶æç¤ºä¿®å¤

**å†³ç­–åˆ†æ”¯**:
```
å®¡æŸ¥ç»“æœæ—  FATAL â†’ ç»§ç»­ Phase 5
å®¡æŸ¥ç»“æœæœ‰ FATAL â†’ æç¤ºä¿®å¤ï¼Œä¿®å¤åå¤æŸ¥ï¼ˆæœ€å¤š 3 è½®ï¼‰
  â”œâ”€ å¤æŸ¥é€šè¿‡ â†’ ç»§ç»­ Phase 5
  â””â”€ è¾¾åˆ° 3 è½®ä»æœ‰ FATAL â†’ åœæ­¢å¾ªç¯ï¼Œåˆ—å‡ºæœªè§£å†³é¡¹ï¼Œè¯¢é—®ç”¨æˆ·ï¼š
       (a) æ‰‹åŠ¨ä¿®å¤åé‡æ–°æäº¤
       (b) è·³è¿‡å®¡æŸ¥ç»§ç»­ Phase 5ï¼ˆè®°å½•ä¸ºå·²çŸ¥é£é™©ï¼‰
ç”¨æˆ·è·³è¿‡ â†’ ç›´æ¥è¿›å…¥ Phase 5
```

**ç”¨æˆ·ç¡®è®¤ç‚¹**: æ˜¯å¦æ¥å—å®¡æŸ¥ç»“æœå¹¶ç»§ç»­

**é»˜è®¤è¡Œä¸º**: è·³è¿‡ï¼ˆä¸åŠ  `--review` æ—¶ä¸æ‰§è¡Œæ­¤é˜¶æ®µï¼‰

---

### Phase 5: æµ‹è¯•å¥—ä»¶ (generate-qa-suite)

**è§¦å‘æ¡ä»¶**: Phase 4ï¼ˆæˆ– Phase 4.5ï¼‰å®Œæˆ

**æ‰§è¡Œå†…å®¹**:
1. è§£æ ETL ä¸Šä¸‹æ–‡ï¼ˆæºè¡¨ã€ç›®æ ‡è¡¨ã€ä¸»é”®ã€å­—æ®µç±»å‹ï¼‰
2. ç”Ÿæˆå†’çƒŸæµ‹è¯•ï¼ˆè¡Œæ•°ã€ä¸»é”®å”¯ä¸€æ€§ã€NULL æ£€æŸ¥ã€æ ·æœ¬æŠ½æŸ¥ï¼‰
3. ç”Ÿæˆ DQC è§„åˆ™ï¼ˆå®Œæ•´æ€§ã€å”¯ä¸€æ€§ã€æœ‰æ•ˆæ€§ã€ä¸€è‡´æ€§ã€æ³¢åŠ¨ç‡ï¼‰
4. Doris ä¸“é¡¹ï¼šç”Ÿæˆ EXPLAIN åˆ†æè¯·æ±‚

**è¾“å‡º**: å®Œæ•´çš„ QA Suiteï¼ˆå†’çƒŸæµ‹è¯• + DQC è§„åˆ™ + æ€§èƒ½åˆ†æï¼‰

**ç”¨æˆ·ç¡®è®¤ç‚¹**: æµ‹è¯•è¦†ç›–æ˜¯å¦å……åˆ†

---

## äº¤ä»˜ç‰©æ±‡æ€»

æµç¨‹å®Œæˆåï¼Œè¾“å‡ºä»¥ä¸‹äº¤ä»˜ç‰©ï¼š

```
ğŸ“¦ äº¤ä»˜ç‰©
â”œâ”€â”€ ğŸ“„ éœ€æ±‚åˆ†æ.md             â† Phase 1 è¾“å‡º
â”œâ”€â”€ ğŸ“„ å¤ç”¨åˆ†æ.md             â† Phase 2 è¾“å‡ºï¼ˆæŒ‡æ ‡å¤ç”¨/å»ºæ¨¡å†³ç­–ï¼‰
â”œâ”€â”€ ğŸ“„ {table_name}_ddl.sql    â† Phase 3 è¾“å‡º
â”œâ”€â”€ ğŸ“„ {table_name}_etl.sql    â† Phase 4 è¾“å‡ºï¼ˆæ—¥å¸¸å¢é‡ï¼Œå«è¡€ç¼˜æ³¨é‡Šï¼‰
â”œâ”€â”€ ğŸ“„ {table_name}_init.sql   â† Phase 4 è¾“å‡ºï¼ˆå¯é€‰ï¼Œå†å²å›åˆ·ï¼‰
â”œâ”€â”€ ğŸ“„ {table_name}_qa.sql     â† Phase 5 è¾“å‡º
â””â”€â”€ ğŸ“Š å…ƒæ•°æ®æ›´æ–°
    â”œâ”€â”€ æŒ‡æ ‡åº“: indicator_registry (æ–°æŒ‡æ ‡)
    â””â”€â”€ è¡€ç¼˜åº“: data_lineage, column_lineage (è‡ªåŠ¨é‡‡é›†)
```

---

## çŠ¶æ€æœº

å·¥ä½œæµçŠ¶æ€è½¬æ¢ï¼š

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      START       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ PHASE_1_TRIAGE   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”‚ PHASE_2_SEARCH   â”‚â”€â”€â”€â”€â”€â”€â”€â”
            â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
            â”‚ å¤ç”¨                              â”‚ å¼€å‘
            â–¼                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   COMPLETE   â”‚                  â”‚ PHASE_3_DDL      â”‚
    â”‚  (ç›´æ¥å¤ç”¨)   â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
                                               â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ PHASE_4_ETL      â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚ --review?     â”‚
                                       â–¼               â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   (è·³è¿‡)
                              â”‚PHASE_4.5     â”‚     â”‚
                              â”‚_REVIEW (å¯é€‰) â”‚     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                                     â”‚             â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                            â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ PHASE_5_QA       â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚    COMPLETE      â”‚
                                      â”‚   (å…¨é‡äº¤ä»˜)      â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é¡¹ç›®è®°å¿† (Project Memory)

å·¥ä½œæµä¸ MEMORY.mdï¼ˆauto memoryï¼‰è”åŠ¨ï¼Œå®ç°è·¨ä¼šè¯æŒç»­ç§¯ç´¯ã€‚

### è¯»å–æ—¶æœº

| é˜¶æ®µ | è¯»å–å†…å®¹ | ç”¨é€” |
|------|---------|------|
| Phase 2 å¼€å§‹å‰ | MEMORY.md è¡¨æ¸…å• | è¡¥å…… MCP æœç´¢ç»“æœï¼Œè¯†åˆ«è¿‘æœŸæ–°å»ºä½†å…ƒæ•°æ®æœªåŒæ­¥çš„è¡¨ |
| Phase 2 å¼€å§‹å‰ | pitfalls.md æºè¡¨ç‰¹æ€§ | äº†è§£æºè¡¨å·²çŸ¥é—®é¢˜ï¼ˆNULLã€è´Ÿå€¼ã€åˆ†åŒºç‰¹æ®Šæ€§ï¼‰ |
| Phase 3 å¼€å§‹å‰ | MEMORY.md å†³ç­–æ—¥å¿— | å‚è€ƒå†å²å†³ç­–ä¿æŒä¸€è‡´æ€§ |
| Phase 4 å¼€å§‹å‰ | pitfalls.md ETL é”™è¯¯ | æ³¨å…¥åˆ° Step 2.5 è‡ªæ£€æ¸…å• |
| å…¨æµç¨‹ | MEMORY.md ç”¨æˆ·åå¥½ | æ²¿ç”¨ç”¨æˆ·å·²ç¡®è®¤çš„åå¥½ï¼Œå‡å°‘é‡å¤æé—® |

### å†™å…¥æ—¶æœº

æ¯ä¸ª Phase å®Œæˆåï¼Œ**è‡ªåŠ¨æ›´æ–° MEMORY.md**ï¼š

| é˜¶æ®µå®Œæˆ | å†™å…¥å†…å®¹ | ç›®æ ‡ä½ç½® |
|---------|---------|---------|
| Phase 1 | æ—  | â€” |
| Phase 2ï¼ˆå†³å®šå¤ç”¨ï¼‰ | è®°å½•å¤ç”¨å†³ç­– | å†³ç­–æ—¥å¿— |
| Phase 3ï¼ˆDDL ç”Ÿæˆï¼‰ | è¡¨åã€ç²’åº¦ã€æ“ä½œç±»å‹ï¼ˆæ–°å»º/æ‰©åˆ—ï¼‰ | è¡¨æ¸…å• + å†³ç­–æ—¥å¿— |
| Phase 4ï¼ˆETL ç”Ÿæˆï¼‰ | æ–°æ³¨å†Œçš„æŒ‡æ ‡ | å†³ç­–æ—¥å¿— |
| Phase 5 | æ—  | â€” |
| ç”¨æˆ·æŒ‡å‡º ETL é—®é¢˜æ—¶ | é—®é¢˜æè¿°ã€åŸå› ã€ä¿®æ­£æ–¹å¼ | pitfalls.md |
| é¦–æ¬¡è¿è¡Œæ—¶ | é‡‡é›†ç”¨æˆ·åå¥½ï¼ˆå­˜å‚¨æ ¼å¼ã€ç¡®è®¤æ¨¡å¼ç­‰ï¼‰ | ç”¨æˆ·åå¥½ |

### è®°å¿†æ–‡ä»¶ä½ç½®

- `MEMORY.md` â€” auto memory ä¸»æ–‡ä»¶ï¼ˆè¡¨æ¸…å•ã€å†³ç­–æ—¥å¿—ã€ç”¨æˆ·åå¥½ï¼‰
- `pitfalls.md` â€” è¸©å‘è®°å½•ï¼ˆæºè¡¨ç‰¹æ€§ã€ETL é”™è¯¯ã€DQC çœŸå®ç¼ºé™·ï¼‰

---

## ä¸Šä¸‹æ–‡ä¼ é€’

å„é˜¶æ®µä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼š

| æºé˜¶æ®µ | ç›®æ ‡é˜¶æ®µ | ä¼ é€’å†…å®¹ |
|--------|----------|---------|
| Phase 1 â†’ Phase 2 | æŒ‡æ ‡åç§°åˆ—è¡¨ã€ç»´åº¦åˆ—è¡¨ã€å»ºè®®åˆ†å±‚/å¼•æ“ |
| Phase 2 â†’ Phase 3 | æŒ‡æ ‡å¤ç”¨ç»“æœã€ç°æœ‰è¡¨æœç´¢ç»“æœã€ç²’åº¦åŒ¹é…åˆ¤æ–­ã€è¯æ ¹æŸ¥è¯¢ç»“æœ |
| Phase 3 â†’ Phase 4 | ç›®æ ‡è¡¨ DDLï¼ˆå«ä¸»é”®ã€å­—æ®µåˆ—è¡¨ã€COMMENTï¼‰ |
| Phase 4 â†’ Phase 4.5 | ETL SQLï¼ˆå¯é€‰ï¼Œ--review æ—¶ä¼ é€’ï¼‰ |
| Phase 4 / 4.5 â†’ Phase 5 | ETL SQLï¼ˆå«æºè¡¨ã€åŠ å·¥é€»è¾‘ï¼‰ã€ç›®æ ‡è¡¨ DDL |
| Phase 4 â†’ æŒ‡æ ‡åº“ | æ–°æŒ‡æ ‡æ³¨å†Œè¯·æ±‚ |
| Phase 4 â†’ è¡€ç¼˜åº“ | è¡¨çº§/å­—æ®µçº§è¡€ç¼˜å…³ç³»ï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰ |
| Phase 3 â†’ MEMORY.md | è¡¨æ¸…å•æ›´æ–°ï¼ˆæ–°å»º/æ‰©åˆ—ï¼‰ |
| Phase 4 â†’ MEMORY.md | å†³ç­–æ—¥å¿—æ›´æ–°ï¼ˆæŒ‡æ ‡å…¥åº“ï¼‰ |
| ç”¨æˆ·åé¦ˆ â†’ pitfalls.md | è¸©å‘è®°å½•ï¼ˆæºè¡¨ç‰¹æ€§ã€ETL é”™è¯¯ï¼‰ |

---

## å¼‚å¸¸å¤„ç†

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| Phase 1 æ— æ³•è¯†åˆ«æ•°ä»“éœ€æ±‚ | è¾“å‡º"éæ•°ä»“éœ€æ±‚"ï¼Œæµç¨‹ç»ˆæ­¢ |
| Phase 2 æŒ‡æ ‡å£å¾„å†²çª | è¯¢é—®ç”¨æˆ·ç¡®è®¤ï¼šå¤ç”¨/é‡æ–°å¼€å‘ |
| Phase 2 ç²’åº¦æ— æ³•ç¡®å®š | æ ‡è®°"ç²’åº¦å¾…ç¡®è®¤"ï¼Œè¯¢é—®ç”¨æˆ· |
| Phase 3 å»ºæ¨¡å†²çª (CASE C) | è¯¢é—®ç”¨æˆ·ï¼šæ‰©åˆ—/æ–°å»º/å…¶ä»– |
| Phase 4 æ˜ å°„å…³ç³»ä¸æ˜ç¡® | è¯¢é—®ç”¨æˆ·ç¡®è®¤æºå­—æ®µ |
| Phase 5 æ— æ³•åŒ¹é… DQC è§„åˆ™ | ç”Ÿæˆé€šç”¨è§„åˆ™ + æ ‡è®°å¾…äººå·¥è¡¥å…… |

---

## MCP å·¥å…·ä¾èµ–

æœ¬å·¥ä½œæµä¾èµ– `search-hive-metadata` MCP Server æä¾›çš„å·¥å…·ï¼š

| å·¥å…· | ç”¨é€” | ä½¿ç”¨é˜¶æ®µ |
|------|------|---------|
| `search_existing_indicators` | æŒ‡æ ‡åº“æŸ¥è¯¢ï¼Œå¤ç”¨åˆ¤æ–­ | Phase 2 |
| `search_table` | æŒ‰è¡¨åæœç´¢ç°æœ‰è¡¨ | Phase 2, 3 |
| `search_by_comment` | æŒ‰ä¸šåŠ¡æœ¯è¯­æœç´¢è¡¨/å­—æ®µ | Phase 2 |
| `get_table_detail` | è·å–è¡¨è¯¦æƒ…ï¼ˆå«ç²’åº¦ä¿¡æ¯ï¼‰ | Phase 2, 3 |
| `search_word_root` | æŸ¥è¯¢è¯æ ¹ï¼Œæ ‡å‡†åŒ–å­—æ®µå‘½å | Phase 3 |
| `register_indicator` | æ–°æŒ‡æ ‡å…¥åº“ | Phase 4 |
| `register_lineage` | æ³¨å†Œè¡¨çº§/å­—æ®µçº§è¡€ç¼˜ | Phase 4 |
| `search_lineage_upstream` | æŸ¥è¯¢ä¸Šæ¸¸ä¾èµ–ï¼ˆæˆ‘ä¾èµ–è°ï¼‰ | Phase 2, å½±å“åˆ†æ |
| `search_lineage_downstream` | æŸ¥è¯¢ä¸‹æ¸¸å½±å“ï¼ˆè°ä¾èµ–æˆ‘ï¼‰ | å½±å“åˆ†æ, å˜æ›´è¯„ä¼° |

### MCP ä¸å¯ç”¨æ—¶çš„é™çº§ç­–ç•¥

å½“ MCP Server è¿æ¥å¤±è´¥æˆ–è¶…æ—¶æ—¶ï¼ŒæŒ‰ä»¥ä¸‹ç­–ç•¥é™çº§ï¼Œ**ä¸é˜»å¡å·¥ä½œæµ**ï¼š

| å·¥å…·ç±»å‹ | é™çº§æ–¹å¼ | å½±å“ |
|---------|---------|------|
| **æŸ¥è¯¢ç±»** (`search_table`, `search_by_comment`, `get_table_detail`, `list_columns`, `search_word_root`, `search_existing_indicators`, `search_lineage_*`) | å‘ŠçŸ¥ç”¨æˆ· MCP ä¸å¯ç”¨ï¼Œè¯·æ±‚ç”¨æˆ·æ‰‹åŠ¨æä¾›æ‰€éœ€ä¿¡æ¯ï¼ˆè¡¨åã€å­—æ®µåˆ—è¡¨ã€æŒ‡æ ‡å£å¾„ç­‰ï¼‰ï¼Œç„¶åç»§ç»­æµç¨‹ | å…ƒæ•°æ®è‡ªåŠ¨è¡¥å…¨å¤±æ•ˆï¼Œä¾èµ–ç”¨æˆ·è¾“å…¥ |
| **å†™å…¥ç±»** (`register_indicator`, `register_lineage`) | å°†å¾…æ³¨å†Œæ•°æ®ä»¥ JSON æ ¼å¼è¾“å‡ºåˆ°è„šæœ¬å¤´éƒ¨æ³¨é‡Šä¸­ï¼Œæ ‡è®° `-- [MCP-PENDING]`ï¼Œæç¤ºç”¨æˆ· MCP æ¢å¤åæ‰‹åŠ¨è¡¥å½• | æŒ‡æ ‡/è¡€ç¼˜æ³¨å†Œå»¶åï¼Œä¸å½±å“ SQL äº§å‡º |

**æ£€æµ‹æ–¹å¼**: é¦–æ¬¡è°ƒç”¨ MCP å·¥å…·æ—¶è‹¥è¿”å›è¿æ¥é”™è¯¯æˆ–è¶…æ—¶ï¼Œå³åˆ¤å®šä¸ºä¸å¯ç”¨ï¼Œåç»­æ­¥éª¤è‡ªåŠ¨åˆ‡æ¢é™çº§æ¨¡å¼ï¼Œä¸å†é‡è¯•ã€‚

---

## å¿«æ·å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/dw-workflow` | å¯åŠ¨å®Œæ•´æµç¨‹ |
| `/dw-workflow --from=ddl` | ä» Phase 3 å¼€å§‹ï¼ˆéœ€æä¾›éœ€æ±‚æè¿°ï¼‰ |
| `/dw-workflow --from=etl` | ä» Phase 4 å¼€å§‹ï¼ˆéœ€æä¾› DDLï¼‰ |
| `/dw-workflow --from=qa` | ä» Phase 5 å¼€å§‹ï¼ˆéœ€æä¾› ETL + DDLï¼‰ |
| `/dw-workflow --step` | é€æ­¥æ‰§è¡Œï¼Œæ¯æ­¥ç¡®è®¤ |
| `/dw-workflow --review` | ETL ç”Ÿæˆåæ‰§è¡Œ SQL å®¡æŸ¥ï¼ˆPhase 4.5ï¼‰ |
| `/dw-workflow --dry-run` | ä»…åˆ†æï¼Œä¸ç”Ÿæˆæ–‡ä»¶ |

---

## å®Œæ•´ç¤ºä¾‹

**ç”¨æˆ·è¾“å…¥**:
```
éœ€æ±‚: è¿è¥éœ€è¦ä¸€å¼ æ”¾æ¬¾äº§å“æ—¥æŠ¥è¡¨ï¼Œç»Ÿè®¡æ¯æ—¥å„äº§å“çš„æ”¾æ¬¾é‡‘é¢ã€æ”¾æ¬¾ç¬”æ•°ï¼Œ
     æ”¯æŒæŸ¥çœ‹æ—¥ç¯æ¯”å˜åŒ–ã€‚æ•°æ® T+1 æ›´æ–°å³å¯ã€‚
```

**å·¥ä½œæµæ‰§è¡Œ**:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Phase 1: éœ€æ±‚æ‹†è§£ (dw-requirement-triage)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[åˆ†æç»“æœ]
â€¢ éœ€æ±‚ç±»å‹: èšåˆç»Ÿè®¡
â€¢ æŒ‡æ ‡: æ”¾æ¬¾é‡‘é¢(SUM), æ”¾æ¬¾ç¬”æ•°(COUNT), æ—¥ç¯æ¯”(LAG)
â€¢ ç»´åº¦: äº§å“ç¼–ç , æ•°æ®æ—¥æœŸ
â€¢ æ—¶é—´ç²’åº¦: æ—¥
â€¢ å»ºè®®åˆ†å±‚: dm (å¯å¤ç”¨çš„æŒ‡æ ‡å®½è¡¨)
â€¢ å»ºè®®å¼•æ“: Hive (T+1 æ‰¹å¤„ç†)

è¯·ç¡®è®¤æ˜¯å¦æ­£ç¡®ï¼Ÿ[Y/n]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Phase 2: å¤ç”¨æ£€ç´¢ (search-hive-metadata)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[æŒ‡æ ‡åº“æŸ¥è¯¢]
â€¢ search_existing_indicators("æ”¾æ¬¾é‡‘é¢") â†’ æœªæ‰¾åˆ°å®Œå…¨åŒ¹é…
â€¢ search_existing_indicators("æ”¾æ¬¾ç¬”æ•°") â†’ æœªæ‰¾åˆ°

[ç°æœ‰è¡¨æœç´¢]
â€¢ search_table("loan") â†’ æ‰¾åˆ° dm.dmm_sac_loan_chn_daily (æ¸ é“ç»´åº¦)
â€¢ ç²’åº¦å¯¹æ¯”: ç°æœ‰è¡¨ = (channel_code, stat_date)ï¼Œéœ€æ±‚ = (product_code, stat_date) â†’ ä¸åŒ¹é…

[å†³ç­–] éœ€è¦æ–°å»ºè¡¨

[è¯æ ¹æŸ¥è¯¢]
â€¢ search_word_root("æ”¾æ¬¾") â†’ loan
â€¢ search_word_root("é‡‘é¢") â†’ amt
â€¢ search_word_root("ç¬”æ•°") â†’ cnt

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Phase 3: æ¨¡å‹è®¾è®¡ (generate-standard-ddl)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[å»ºæ¨¡å†³ç­–] CASE B: æ–°å»ºè¡¨
[è¡¨å] dm.dmm_sac_loan_prod_daily
[ç²’åº¦] ä¸€è¡Œ = ä¸€å¤© Ã— ä¸€äº§å“

[DDL]
CREATE TABLE IF NOT EXISTS dm.dmm_sac_loan_prod_daily (
    product_code          STRING          COMMENT 'äº§å“ç¼–ç ',
    product_name          STRING          COMMENT 'äº§å“åç§°',
    td_sum_loan_amt       DECIMAL(18,2)   COMMENT 'å½“æ—¥æ”¾æ¬¾æ€»é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
    td_cnt_loan           BIGINT          COMMENT 'å½“æ—¥æ”¾æ¬¾ç¬”æ•°',
    td_diff_loan_amt      DECIMAL(18,2)   COMMENT 'æ”¾æ¬¾é‡‘é¢æ—¥ç¯æ¯”å·®å€¼'
)
COMMENT 'è´·æ¬¾äº§å“æ—¥ç»´åº¦æŒ‡æ ‡å®½è¡¨ [ç²’åº¦ï¼šäº§å“ç¼–ç ï¼Œæ•°æ®æ—¥æœŸ]'
PARTITIONED BY (stat_date STRING COMMENT 'æ•°æ®æ—¥æœŸ')
STORED AS ORC
TBLPROPERTIES (
    'orc.compress' = 'SNAPPY',
    'logical_primary_key' = 'product_code,stat_date'
);

DDL æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Ÿ[Y/n]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Phase 4: ETL å¼€å‘ (generate-etl-sql)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[åŠ å·¥æ¨¡å¼] æ··åˆæ¨¡å¼ (èšåˆ + çª—å£å‡½æ•°)
[æºè¡¨] dwd.dwd_loan_detail, dim.dim_product

[ETL SQL]
WITH agg AS (
    SELECT product_code,
           SUM(loan_amount) AS td_sum_loan_amt,
           COUNT(loan_id)   AS td_cnt_loan
    FROM dwd.dwd_loan_detail
    WHERE stat_date = '${hivevar:stat_date}'
    GROUP BY product_code
),
agg_prev AS (
    SELECT product_code,
           SUM(loan_amount) AS yd_sum_loan_amt
    FROM dwd.dwd_loan_detail
    WHERE stat_date = DATE_ADD('${hivevar:stat_date}', -1)
    GROUP BY product_code
)
INSERT OVERWRITE TABLE dm.dmm_sac_loan_prod_daily PARTITION (stat_date)
SELECT
    a.product_code,
    dim.product_name,
    a.td_sum_loan_amt,
    a.td_cnt_loan,
    a.td_sum_loan_amt - COALESCE(ap.yd_sum_loan_amt, 0) AS td_diff_loan_amt,
    '${hivevar:stat_date}' AS stat_date
FROM agg a
LEFT JOIN dim.dim_product dim ON a.product_code = dim.product_code
LEFT JOIN agg_prev ap ON a.product_code = ap.product_code;

[æ–°æŒ‡æ ‡å…¥åº“]
å‘ç° 3 ä¸ªæ–°æŒ‡æ ‡å°šæœªå…¥åº“ï¼š
1. å½“æ—¥æ”¾æ¬¾é‡‘é¢ (td_sum_loan_amt)
2. å½“æ—¥æ”¾æ¬¾ç¬”æ•° (td_cnt_loan)
3. æ”¾æ¬¾é‡‘é¢æ—¥ç¯æ¯” (td_diff_loan_amt)

æ˜¯å¦æ³¨å†Œä¸ºå…¬å…±æŒ‡æ ‡ï¼Ÿ[A]å…¨éƒ¨ / [B]é€‰æ‹© / [C]ä¸æ³¨å†Œ

[è¡€ç¼˜æ³¨å†Œ] âœ“ è‡ªåŠ¨å®Œæˆ
â€¢ è¡¨çº§è¡€ç¼˜: dm.dmm_sac_loan_prod_daily â† dwd.dwd_loan_detail, dim.dim_product
â€¢ å­—æ®µçº§è¡€ç¼˜: td_sum_loan_amt â† SUM(dwd.dwd_loan_detail.loan_amount)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Phase 5: æµ‹è¯•å¥—ä»¶ (generate-qa-suite)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[å†’çƒŸæµ‹è¯•]
â€¢ S-01: ç›®æ ‡è¡¨è¡Œæ•° > 0
â€¢ S-02: æºè¡¨ vs ç›®æ ‡è¡¨è¡Œæ•°å¯¹æ¯”
â€¢ S-03: ä¸»é”®å”¯ä¸€æ€§ (product_code, stat_date)
â€¢ S-04: å…³é”®å­—æ®µé NULL
â€¢ S-05: æ•°æ®æ ·æœ¬æŠ½æŸ¥ (LIMIT 20)

[DQC è§„åˆ™]
â€¢ DQC-C02: product_code é NULL
â€¢ DQC-U01: ä¸»é”®å”¯ä¸€
â€¢ DQC-V01: td_sum_loan_amt >= 0
â€¢ DQC-V04: td_cnt_loan >= 0
â€¢ DQC-VOL01: è¡Œæ•°æ³¢åŠ¨æ£€æŸ¥

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 äº¤ä»˜ç‰©æ±‡æ€»
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… dm.dmm_sac_loan_prod_daily_ddl.sql    (DDL)
âœ… dm.dmm_sac_loan_prod_daily_etl.sql    (ETL + è¡€ç¼˜æ³¨é‡Š)
âœ… dm.dmm_sac_loan_prod_daily_qa.sql     (æµ‹è¯•å¥—ä»¶)
âœ… æŒ‡æ ‡åº“å·²æ›´æ–° (3 æ¡æ–°æŒ‡æ ‡)
âœ… è¡€ç¼˜åº“å·²æ›´æ–° (2 æ¡è¡¨çº§è¡€ç¼˜ï¼Œ5 æ¡å­—æ®µçº§è¡€ç¼˜)

æµç¨‹å®Œæˆï¼
```

---

## é…ç½®è¦æ±‚

### MCP Server é…ç½®

æœ¬å·¥ä½œæµéœ€è¦ `search-hive-metadata` MCP Server æ­£å¸¸è¿è¡Œï¼š

```json
{
  "mcpServers": {
    "hive-metadata": {
      "command": "python",
      "args": ["path/to/mcp_server.py"],
      "env": {
        "MYSQL_HOST": "mysql-host",
        "MYSQL_DATABASE": "hive_metadata",
        "PG_HOST": "pg-host",
        "PG_DATABASE": "indicator_db"
      }
    }
  }
}
```

### ç›¸å…³ Skill

ç¡®ä¿ä»¥ä¸‹ skill å·²å®‰è£…ï¼š

- `dw-requirement-triage.skill`
- `generate-standard-ddl.skill`
- `generate-etl-sql.skill`
- `review-sql` (å¯é€‰ï¼ŒPhase 4.5 å®¡æŸ¥)
- `generate-qa-suite.skill`
